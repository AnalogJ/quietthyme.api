machine:
  node:
    version: 4.3.0

general:
  branches:
    only:
      - master
      - beta

dependencies:
  override:
    - npm install -g serverless
    - npm install knex -g
    - npm install
    - npm ls

test:
  override:
    - serverless deploy -v

test:
  override:
    - echo "skipping, no tests"

deployment:
  deploy:
    branch: [beta, master]
    commands:
#      - sls prune -n 4 # remove prune until https://github.com/claygregory/serverless-prune-plugin/issues/1 fixed
      - NODE_ENV=$CIRCLE_BRANCH knex migrate:latest
      - serverless deploy --stage $CIRCLE_BRANCH --region us-east-1